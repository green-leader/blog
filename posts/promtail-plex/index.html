<!doctype html><html lang=en><head><title>Promtail Plex :: Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The other day while watching Plex it would reliably stop playback 2 minutes before the end. When it did this an error would pop up &amp;ldquo;Conversion failed. The transcoder exited due to an error.&amp;rdquo; Helpful.
Not a problem. We&amp;rsquo;ll log onto the log server and see what it spat out. Well much to my dismay, Plex doesn&amp;rsquo;t seem to log to the typical I/O streams. While I&amp;rsquo;m not overly surprised it definitely was something I didn&amp;rsquo;t think about."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.sions.org/posts/promtail-plex/><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=https://blog.sions.org/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.sions.org/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Promtail Plex"><meta property="og:description" content="The other day while watching Plex it would reliably stop playback 2 minutes before the end. When it did this an error would pop up &amp;ldquo;Conversion failed. The transcoder exited due to an error.&amp;rdquo; Helpful.
Not a problem. We&amp;rsquo;ll log onto the log server and see what it spat out. Well much to my dismay, Plex doesn&amp;rsquo;t seem to log to the typical I/O streams. While I&amp;rsquo;m not overly surprised it definitely was something I didn&amp;rsquo;t think about."><meta property="og:url" content="https://blog.sions.org/posts/promtail-plex/"><meta property="og:site_name" content="Blog"><meta property="og:image" content="https://blog.sions.org/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-12-11 08:00:00 +0000 UTC"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class=green><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.sions.org/posts/promtail-plex/>Promtail Plex</a></h1><div class=post-meta><time class=post-date>2023-12-11 ::</time></div><span class=post-tags>#<a href=https://blog.sions.org/tags/system-administration/>System Administration</a>&nbsp;
#<a href=https://blog.sions.org/tags/logging/>Logging</a>&nbsp;
#<a href=https://blog.sions.org/tags/promtail/>Promtail</a>&nbsp;
#<a href=https://blog.sions.org/tags/loki/>Loki</a>&nbsp;</span><div class=post-content><div><p>The other day while watching Plex it would reliably stop playback 2 minutes before the end. When it did this an error would pop up &ldquo;Conversion failed. The transcoder exited due to an error.&rdquo; Helpful.</p><p>Not a problem. We&rsquo;ll log onto the log server and see what it spat out. Well much to my dismay, Plex doesn&rsquo;t seem to log to the typical I/O streams. While I&rsquo;m not overly surprised it definitely was something I didn&rsquo;t think about.</p><p>Made sure the actual log files were being exported as intended, and then started the trial and error of getting Promtail to appropriately label the logs and ship them to the Loki server. Here&rsquo;s what I ended up with putting in my scrape config:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Scrape plex logs</span>
</span></span><span style=display:flex><span><span style=color:#75715e># *{r,e,s} is a little hard coded but it allows for ignoring the rotated logs</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>job_name</span>: <span style=color:#ae81ff>plexlogs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pipeline_stages</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>regex</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>expression</span>: <span style=color:#e6db74>&#39;(?P&lt;timestamp&gt;\w{3}\s{1,2}\d{1,2}, \d{4} \d{2}:\d{2}:\d{2}.\d{3}) \[(?P&lt;pid&gt;.*)\] (?P&lt;level&gt;[A-Z]{4,5}) - (?P&lt;message&gt;.*)&#39;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>level</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>storage01</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>job</span>: <span style=color:#ae81ff>plexlogs</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>__path__</span>: <span style=color:#ae81ff>/var/log_plex/*{r,e,s}.log</span>
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.sions.org/posts/docker-logs/><span class=button__text>Docker Logs</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>