<!doctype html><html lang=en><head><title>Publishing Obsidian Documentation :: Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I keep my notes in markdown files in a git repo my primary editor is a tool called obsidian.md. I&amp;rsquo;ve got minor gripes and for the most part I&amp;rsquo;ve got it syncing well and working well. However, a nice to have feature would be to share individual documents with the public. Couple examples, keeping a digital recipe box for the household to read from or sharing TTRPG notes after a session."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.sions.org/posts/docs-publishing/><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=https://blog.sions.org/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.sions.org/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Publishing Obsidian Documentation"><meta property="og:description" content="I keep my notes in markdown files in a git repo my primary editor is a tool called obsidian.md. I&amp;rsquo;ve got minor gripes and for the most part I&amp;rsquo;ve got it syncing well and working well. However, a nice to have feature would be to share individual documents with the public. Couple examples, keeping a digital recipe box for the household to read from or sharing TTRPG notes after a session."><meta property="og:url" content="https://blog.sions.org/posts/docs-publishing/"><meta property="og:site_name" content="Blog"><meta property="og:image" content="https://blog.sions.org/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-02-27 05:33:12 +0000 UTC"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class=green><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.sions.org/posts/docs-publishing/>Publishing Obsidian Documentation</a></h1><div class=post-meta><time class=post-date>2023-02-27 ::</time></div><span class=post-tags>#<a href=https://blog.sions.org/tags/homelab/>homelab</a>&nbsp;
#<a href=https://blog.sions.org/tags/documentation/>documentation</a>&nbsp;
#<a href=https://blog.sions.org/tags/docker/>docker</a>&nbsp;</span><div class=post-content><div><p>I keep my notes in markdown files in a git repo my primary editor is a tool called <a href=https://obsidian.md/>obsidian.md</a>. I&rsquo;ve got minor gripes and for the most part I&rsquo;ve got it syncing well and working well. However, a nice to have feature would be to share individual documents with the public. Couple examples, keeping a digital recipe box for the household to read from or sharing TTRPG notes after a session.</p><p>For right now I want to set it up such that I can share things with the household. Log into the designated subdomain, and so long as you&rsquo;re on my network using my DNS server it should load happily.</p><p>Here&rsquo;s the process I&rsquo;ve taken and settled on for now.</p><p>Workflow:</p><ol><li>sync git repo</li><li>process markdown into HTML</li><li>serve HTML with a web server</li></ol><p>Tools:</p><ol><li>Githubs cli tool <a href=https://github.com/cli/cli>github.com/cli/cli</a></li><li><a href=https://github.com/devidw/obsidian-to-hugo>obsidian-to-hugo</a></li><li><a href=https://gohugo.io/>hugp</a></li><li>nginx running on docker</li></ol><h3 id=workflow-step-1>Workflow Step 1:<a href=#workflow-step-1 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Something I&rsquo;ve been trying to deal with and come up with a solution I like is giving my server read-only access to multiple private repos. As of the time of this writing I keep most of my git repositories located at github. Github doesn&rsquo;t allow you to specify an ssh key as a deploy key to multiple projects. And the deploy keys work great if you only need to grant access to 1 repo. But this runs into problems when you&rsquo;re trying to grant access to several, purely from a management standpoint. how you do you cleanly associate an ssh key with individual repos then refer to them. I saw some hacks online but I hadn&rsquo;t liked any of them.</p><p>Doing a bit of experimenting on this when I was trying to deploy this I remembered the Github CLI tool. After some trial and error I found that you can not use a personal access token however neither fine-grained tokens or classic tokens seem to have access to just perform read-only actions on the content of repos. I ended up using http authentication, logging in as myself. While writing this I&rsquo;m trying to think if it&rsquo;s got read-only access or full read-write. I&rsquo;ll have to investigate it later.</p><h3 id=workflow-step-2>Workflow Step 2:<a href=#workflow-step-2 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Processing markdown files into HTML is a joint problem. There&rsquo;s a number of static site generators that will take in markdown and output HTML. The tool i&rsquo;m most familiar with is hugo, which is what this blog is using. Doing a bit of research I found a python module that converts obsidian markdown files into hugo markdown files.</p><p>looking at the readme it also provides functionality on scanning the contents of the file for specific conditions as to whether it should graduate into a published document. I&rsquo;ve got a small python script written below which I run before I have hugo process the documents into HTML.</p><p>process.py:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> obsidian_to_hugo <span style=color:#f92672>import</span> ObsidianToHugo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_file</span>(file_contents: str, file_path: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;publish: true</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>---&#34;</span> <span style=color:#f92672>in</span> file_contents:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;template_&#34;</span> <span style=color:#f92672>in</span> file_path:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>obsidian_to_hugo <span style=color:#f92672>=</span> ObsidianToHugo(
</span></span><span style=display:flex><span>    obsidian_vault_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/local/kb-obsidian&#34;</span>,
</span></span><span style=display:flex><span>    hugo_content_dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/local/hugo-site/content&#34;</span>,
</span></span><span style=display:flex><span>    filters<span style=color:#f92672>=</span>[filter_file],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>obsidian_to_hugo<span style=color:#f92672>.</span>run()
</span></span></code></pre></div><p>This is a pretty strightforward snippet on the python projects readme I&rsquo;ve adjusted a bit for my needs.</p><p>After generating the content with that processing script we now need to trigger hugo to run and convert the content markdown files into HTML. Creating and configuring the initial hugo site only needs to be done the first time, but after that you can just change to the hugo site directory, then execute a simple <code>hugo</code>. Depending on which theme you&rsquo;re using it could require the extended version of hugo. Below I&rsquo;ve included my config file.</p><p>When taking notes I will add page links to pages that don&rsquo;t exist. This can cause hugo to throw a fit and refuse to process then the files.
<code>REF_NOT_FOUND: Ref "Azure": &lt;snip>: page not found</code></p><p>Adding <code>refLinksErrorLevel = "WARNING"</code> to the config file results in warnings still being emitted but will tell hugo that it&rsquo;s alright.</p><p>hugo config.toml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>baseURL</span> = <span style=color:#e6db74>&#39;/&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#a6e22e>languageCode</span> = <span style=color:#e6db74>&#39;en-us&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>title</span> = <span style=color:#e6db74>&#39;My New Hugo Site&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>theme</span> = <span style=color:#e6db74>&#39;ananke&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>refLinksErrorLevel</span> = <span style=color:#e6db74>&#34;WARNING&#34;</span>
</span></span></code></pre></div><h3 id=workflow-step-3>Workflow Step 3:<a href=#workflow-step-3 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>This is for the most part the simplest step, couple bullet points:</p><ul><li>Create a custom nginx config</li><li>Point nginx at the hugo sites public directory</li><li>Launch nginx container</li></ul><p>I like to set the volume mounting and launch the container to create the directory structure. Replacing <code>nginx/nginx/site-confs/default.conf</code> with our custom config.</p><p>nginx config file</p><pre tabindex=0><code>server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name _;

    set $root /app/www/public;
    if (!-d /app/www/public) {
        set $root /config/www;
    }
    root $root;
    index index.HTML;

    location / {
        try_files $uri $uri/ /index.HTML /index.php$is_args$args =404;
        add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;; # Allow access to resources (for www and non www)
    }
}
</code></pre><p>docker-compose.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;2.1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx-docs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>lscr.io/linuxserver/nginx:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_file</span>: <span style=color:#ae81ff>.env</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./hugo-site/public:/config/www</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>3003</span>:<span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mgmt_network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs-http.entrypoints=web&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs-http.rule=Host(`docs.${DOMAIN}`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs-http.middlewares=docs-https&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.middlewares.docs-https.redirectscheme.scheme=https&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs.entrypoints=websecure&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs.rule=Host(`docs.${DOMAIN}`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs.tls=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.docs.tls.certresolver=myresolver&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.services.docs.loadbalancer.server.port=80&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>mgmt_network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>Now when someone on the wifi goes the the subdomain docs on my internal domain name they get served the default hugo index page. There&rsquo;s no sitemap, but if things link to each other correctly it&rsquo;s plenty user friendly. While it&rsquo;s not pretty it&rsquo;s a minimum viable product and I plan to further iterate on it.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.sions.org/posts/boring-week/><span class=button__icon>←</span>
<span class=button__text>I got my Network+ last week</span></a></span>
<span class="button next"><a href=https://blog.sions.org/posts/splunk-setup/><span class=button__text>Splunk Setup</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>