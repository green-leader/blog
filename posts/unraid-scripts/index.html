<!doctype html><html lang=en><head><title>Unraid Scripts :: Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="One of the services my unRaid box runs is a borgbackup server (which is secretly just an SSH server with a forced command). As a check to make sure the important repos are indeed getting backed up to I&amp;rsquo;ve got a script running daily via the User Scripts Plugin. It&amp;rsquo;s a pretty simple script, all it does is check when the files in certain target repos have last been written to."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.sions.org/posts/unraid-scripts/><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=https://blog.sions.org/img/theme-colors/green.png><link rel=apple-touch-icon href=https://blog.sions.org/img/theme-colors/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Unraid Scripts"><meta property="og:description" content="One of the services my unRaid box runs is a borgbackup server (which is secretly just an SSH server with a forced command). As a check to make sure the important repos are indeed getting backed up to I&amp;rsquo;ve got a script running daily via the User Scripts Plugin. It&amp;rsquo;s a pretty simple script, all it does is check when the files in certain target repos have last been written to."><meta property="og:url" content="https://blog.sions.org/posts/unraid-scripts/"><meta property="og:site_name" content="Blog"><meta property="og:image" content="https://blog.sions.org/img/favicon/green.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2023-07-05 08:00:00 +0000 UTC"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest></head><body class=green><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://blog.sions.org/posts/unraid-scripts/>Unraid Scripts</a></h1><div class=post-meta><time class=post-date>2023-07-05 ::</time></div><span class=post-tags>#<a href=https://blog.sions.org/tags/system-administration/>System Administration</a>&nbsp;
#<a href=https://blog.sions.org/tags/bash/>Bash</a>&nbsp;
#<a href=https://blog.sions.org/tags/scripting/>Scripting</a>&nbsp;</span><div class=post-content><div><p>One of the services my unRaid box runs is a borgbackup server (which is secretly just an SSH server with a forced command). As a check to make sure the important repos are indeed getting backed up to I&rsquo;ve got a script running daily via the <em>User Scripts</em> Plugin. It&rsquo;s a pretty simple script, all it does is check when the files in certain target repos have last been written to. If it hasn&rsquo;t been in the last 7 days we send a Discord message for awareness.</p><p>Recently I was performing some maintenance and my script ran warning me that they all had not been written to within that cutoff. While I was investigating the logs it took me an embarrassingly long period of time to realize the unRaid array was simply not running. So, where the script was checking was missing. Time to add some safety to the script. Now the first section runs and the script will exit if the Array isn’t running.</p><p>Borg Check Script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check if array is started</span>
</span></span><span style=display:flex><span>ls /mnt/disk<span style=color:#f92672>[</span>1-9<span style=color:#f92672>]</span>* 1&gt;/dev/null 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! ls /mnt/disk<span style=color:#f92672>[</span>1-9<span style=color:#f92672>]</span>*
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>   echo <span style=color:#e6db74>&#34;ERROR:  Array must be started before using this script&#34;</span>
</span></span><span style=display:flex><span>   exit
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>readonly WEBHOOK_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://discord.com/api/webhooks/0000/XXXX&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List of directories to check</span>
</span></span><span style=display:flex><span>readonly WATCH_DIRS<span style=color:#f92672>=(</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/mnt/dir1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/mnt/dir2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/mnt/dir3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Function to send a Discord webhook message</span>
</span></span><span style=display:flex><span>send_discord_message<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  local message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  local payload<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{\&#34;content\&#34;: \&#34;</span>$message<span style=color:#e6db74>\&#34;}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  curl -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -d <span style=color:#e6db74>&#34;</span>$payload<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$WEBHOOK_URL<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Iterate over the directories</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> dir in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>WATCH_DIRS[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Check if any files were modified in the last 7 days</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> find <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>&#34;</span> -type f -newermt <span style=color:#e6db74>&#34;-7 days&#34;</span> 2&gt;/dev/null | grep -q .; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Send Discord webhook message for directories without recent changes</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  MESSAGE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Directory </span>$dir<span style=color:#e6db74> has not been modified in the last 7 days&#34;</span>
</span></span><span style=display:flex><span>  send_discord_message <span style=color:#e6db74>&#34;</span>$MESSAGE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;</span>$MESSAGE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.sions.org/posts/image-change/><span class=button__icon>←</span>
<span class=button__text>Image Change</span></a></span>
<span class="button next"><a href=https://blog.sions.org/posts/full-hd/><span class=button__text>Full Hd</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>